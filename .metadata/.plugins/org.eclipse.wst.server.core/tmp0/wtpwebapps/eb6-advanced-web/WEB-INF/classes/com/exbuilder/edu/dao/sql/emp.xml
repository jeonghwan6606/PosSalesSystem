<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="emp">
	<select id="getEmpList" resultType="HashMap">
		SELECT EMPLOYEE_ID
			   ,FIRST_NAME
			   ,LAST_NAME
			   ,EMAIL
			   ,PHONE_NUMBER
			   ,HIRE_DATE
			   ,DEPARTMENT_ID
			   ,SALARY
			   FROM EMP
		<if test=" NAME != '' and NAME != null ">
			WHERE LAST_NAME LIKE concat('%', #{NAME}, '%')
			OR FIRST_NAME LIKE concat('%', #{NAME}, '%')
		</if>
	</select>	
	
	
	
	<select id = "getDeptList" resultType="HashMap">
		SELECT DEPT_NO
			  ,DEPT_NAME
			   FROM DEPT;
	</select>
	
	
	<insert id="insertEmp" parameterType="HashMap">
		INSERT INTO EMP(
			  HIRE_DATE
			<if test="FIRST_NAME != null and FIRST_NAME != ''">
			, FIRST_NAME
			</if>
			<if test="LAST_NAME != null and LAST_NAME != ''">
			, LAST_NAME
			</if>
			<if test="EMAIL != null and EMAIL != ''">
			, EMAIL
			</if>
			<if test="PHONE_NUMBER != null and PHONE_NUMBER != ''">
			, PHONE_NUMBER
			</if>
			<if test="DEPARTMENT_ID != null and DEPARTMENT_ID != ''">
			, DEPARTMENT_ID
			</if>
			<if test="SALARY != null and SALARY != ''">
			, SALARY
			</if>
			
		)VALUES(
			<choose>
			<when test="HIRE_DATE != null and HIRE_DATE != ''">
			to_date(#{HIRE_DATE} , 'YYYYMMDD') 
			</when>
			<otherwise>
			CURRENT_DATE
			</otherwise>
			</choose>
		  	<if test="FIRST_NAME != null and FIRST_NAME != ''">
			, #{FIRST_NAME}
			</if>
		  	<if test="LAST_NAME != null and LAST_NAME != ''">
			, #{LAST_NAME}
		  	</if>
		  	<if test="EMAIL != null and EMAIL != ''">
			, #{EMAIL}
			</if>
			<if test="PHONE_NUMBER != null and PHONE_NUMBER != ''">
			, #{PHONE_NUMBER}
			</if>
			<if test="DEPARTMENT_ID != null and DEPARTMENT_ID != ''">
			, #{DEPARTMENT_ID}
			</if>
			<if test="SALARY != null and SALARY != ''">
			, #{SALARY}
			</if>
		  	)
	</insert>

	<update id="updateEmp"> 
		UPDATE EMP SET 
			  FIRST_NAME = #{FIRST_NAME}
			, LAST_NAME = #{LAST_NAME}
			, EMAIL = #{EMAIL}
			, PHONE_NUMBER = #{PHONE_NUMBER}
			,
			<choose>
			<when test="HIRE_DATE != null and HIRE_DATE != ''">
			HIRE_DATE = to_date(#{HIRE_DATE} , 'YYYYMMDD') 
			</when>
			<otherwise>
			HIRE_DATE = CURRENT_DATE
			</otherwise>
			</choose>
			
			, DEPARTMENT_ID = #{DEPARTMENT_ID}
			, SALARY = #{SALARY}
		WHERE EMPLOYEE_ID = #{EMPLOYEE_ID}
	</update>

	<delete id="deleteEmp">
		DELETE FROM EMP WHERE EMPLOYEE_ID = #{EMPLOYEE_ID}
	</delete>
</mapper>